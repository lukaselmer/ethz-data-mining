#!/usr/bin/env python2.7

import numpy as np
import random
import time
import itertools
import datetime
import sys

# Implementation of Linear UCB
class LinUCB:
   # all_articles = []
    all_M = None
    all_M_inv = None
    all_b = None
    all_w = None
    mapping = {}
    keyList=None
    articleSize = 1
    totalLine = 0
    dayCheck = None

    alpha = 0.2
    current_article = None  # current recommendation
    current_user = None  # user for which the article was recommended


    def set_articles(self, articles):
        print 'We are using an alpha of: %f \n' %(self.alpha)
        print 'VECTORIZED VERSION!!!!!\n'

        self.keyList = np.array(articles.keys())
        self.articleSize = self.keyList.size

        self.all_w = np.zeros((6,self.articleSize))
        M = np.identity(6)
        self.all_M = np.tile(M,(1,self.articleSize))
        self.all_M_inv = np.tile(M,(1,self.articleSize))

        self.all_b = np.zeros((6,self.articleSize))

        for idx, article in enumerate(articles.keys()):
            self.mapping[article] = idx

        good_M_all_raw=''
        good_M_all_inv_raw=''
        good_w_raw=''
        good_b_raw=''
        key_list_old_raw=''

        # 3300000 from subset(oneDay)
        good_M_all_raw='9166.0 2124.25527 56.861932 4265.89904 830.630244 1887.353476 8582.0 982.979353 140.576883 261.750074 466.760723 6728.933297 1334.0 410.38327 19.100434 640.213305 132.374298 130.928601 498.0 30.958831 6.517372 19.966865 5.12993 434.426991 549.0 60.788717 341.649568 49.009292 21.181147 75.37126 621.0 47.916979 9.00781 22.070346 7.180066 533.824764 261.0 32.589139 5.672658 19.99358 4.827009 196.917619 602.0 34.136779 6.594935 20.244893 6.061388 533.962001 499.0 35.948932 7.379856 20.539664 7.085523 427.046025 97778.0 29567.801176 21519.930151 4992.407528 40280.805333 1416.055693 754.0 48.543394 9.492324 51.456696 15.569731 627.937858 274.0 29.337624 26.901 17.53914 5.260454 193.961767 33430.0 1121.268073 146.926194 15977.875037 7300.764322 8882.166005 307.0 42.124202 6.848337 53.381745 11.392829 192.252889 3273.0 71.060321 21.016626 38.678622 56.307216 3084.937287 270.0 40.264458 6.090279 20.879213 5.231048 196.535001 1519.0 97.496526 7.771176 149.535412 67.641635 1195.55525 18284.0 2325.490836 97.577133 10090.116346 2887.393918 2882.421722 270.0 40.39919 6.134638 20.889558 5.116851 196.459758 539.0 34.112924 53.821491 25.672477 26.168109 398.22502 246.0 26.045964 6.264089 16.698312 4.837556 191.154076 1253.0 42.782819 5.829293 26.105835 28.544597 1148.737439 909.0 37.845963 7.838454 22.269768 8.295208 831.750608 310.0 68.144534 9.317812 25.14345 15.255225 191.13898 510.0 46.813883 5.985482 22.719442 8.708417 424.772788 443.0 204.487162 20.922575 48.564658 22.232639 145.792975 336.0 45.986873 5.675091 22.967672 8.599268 251.771088 402.0 101.102434 7.998745 29.471193 13.168414 249.259212 1723.0 619.904455 34.596309 236.486882 68.316212 762.696159 596.0 29.028711 88.055074 16.838596 11.512941 449.564655 270.0 48.494909 5.528856 84.342428 12.606374 118.027438 199.0 57.322917 5.860448 18.270696 8.687057 107.858872 17795.0 2001.400252 99.306664 10295.171183 3877.491774 1520.630103 280.0 44.189876 5.748278 22.381317 8.207235 198.473312 267.0 45.530186 6.260052 25.260472 13.053896 175.895401 307.0 130.354584 12.221977 35.330343 20.806902 107.286172 187.0 49.79285 5.43355 16.311443 7.205039 107.257107 611.0 53.116325 11.702255 20.067429 20.244215 504.869826 1131.0 617.173877 71.722757 119.712466 217.676577 103.714298 118.0 49.849885 5.695086 15.799416 8.891252 36.764367 118.0 49.293064 6.323388 15.747027 8.741935 36.894591 1.0 0.0 0.0 0.0 0.0 0.0 825.0 267.772441 34.671712 75.319344 30.444252 415.792275 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0\n2124.25527 825.69255642 18.2808680604 981.51176766 242.178621611 57.5914233038 982.979353 458.633633123 38.3786272873 107.661754449 134.406886545 244.898466689 410.38327 201.943784698 8.37543171619 140.58853861 47.7061355483 12.7693488406 30.958831 22.5774373649 1.1646888315 4.0359656077 1.5566742118 2.62406095241 60.788717 25.2513224373 22.985582119 6.76007806617 3.92979018364 2.86194541534 47.916979 33.5240838938 1.72867329826 5.20290840138 2.06578115721 6.39553968711 32.589139 25.7779100552 1.09624582867 4.48308876213 1.71712054285 0.514774209852 34.136779 24.6795338248 1.35265053049 4.55532939722 1.72910825089 2.82015996005 35.948932 26.3242998708 1.30253144084 4.53683641168 2.04263063079 2.74263700722 29567.801176 14962.7633849 4230.63680752 1865.7223575 8219.222229 290.456068112 48.543394 27.4226511311 2.18178420059 6.88602223104 4.20805026284 8.84488816749 29.337624 21.8246899585 3.25540859759 2.84017897226 1.56522619531 0.852120864467 1121.268073 120.27507433 9.8888897901 585.24197011 343.088153044 63.7739829049 42.124202 25.8502303316 1.20121128105 11.0624466954 3.14870711209 1.86160774615 71.060321 28.4123939294 2.35483870405 5.84192771675 4.2467817852 31.2043806331 40.264458 31.4839167575 1.46265876068 5.64047530546 1.99556271701 0.681847198478 97.496526 39.6565104766 1.77339407127 33.3276151672 14.5217604943 9.21724632175 2325.490836 799.11989833 26.7636594122 1044.17758946 397.960813326 58.4688770089 40.39919 31.6314165448 1.38929085799 5.59585291114 2.08320158496 0.6994213109 34.112924 18.8325822014 4.36634865239 5.27468573647 4.03892135766 2.60038927758 26.045964 19.8111104148 1.40775070487 3.34087471923 1.67089423926 0.815332394302 42.782819 24.1246705235 0.917042105578 6.32299306317 4.37766629066 8.04044579602 37.845963 24.5757988275 1.39375888586 4.37476356299 1.61463737664 6.88700312846 68.144534 49.1800646155 3.30122466777 8.60175067026 5.88246249436 2.17902688812 46.813883 34.020909658 1.33890064768 6.27436394056 3.05601021407 3.12369836949 204.487162 153.699854517 9.94061386035 23.3746621254 13.0622298302 5.40980049618 45.986873 32.2554537593 1.45582037769 7.16029222417 2.99015812015 3.12514392323 101.102434 75.7319454685 3.14050917824 13.0760825782 6.20349327151 3.95039304585 619.904455 424.189267226 14.4517389526 130.463321819 36.428347129 15.3717700767 29.028711 15.6305868411 6.91802190709 1.9921186534 2.02249145913 3.46548717524 48.494909 30.8592437522 1.25581445295 11.8755692019 3.7420943313 1.76219189586 57.322917 41.4310502237 1.64059604198 10.4972031526 3.7953321756 0.958729900503 2001.400252 571.808863083 19.266695218 957.798893489 423.366833942 30.1589554142 44.189876 32.0292022792 1.5271899037 6.69166903172 2.99604689496 1.94577018896 45.530186 31.4916372436 1.78477330451 7.41818937155 3.98140989161 1.85417580645 130.354584 91.7324821156 5.38977618815 20.4526254956 10.6679392034 3.11175585095 49.79285 37.0151460446 1.32855027759 8.72846326719 3.04121220703 0.679473725989 53.116325 32.5388330054 1.97407153775 7.68847999549 4.37589684256 7.53904599248 617.173877 388.205364069 42.954007571 64.2436913505 114.414123296 8.35667450692 49.849885 36.5650552323 1.68460350708 7.86719812571 4.06110984684 0.671923168486 49.293064 35.9861762499 2.13690658443 7.82673949838 3.81608796783 0.52715494147 0.0 1.0 0.0 0.0 0.0 0.0 267.772441 193.714606474 10.2056628922 43.4838988521 14.4761946443 6.89206286442 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0\n56.861932 18.2808680604 7.85798199856 14.5049770912 8.02633584759 9.19176814707 140.576883 38.3786272873 21.293122572 4.87687027818 17.8794665933 59.1488014706 19.100434 8.37543171619 5.34738842423 2.59731825188 2.80053523968 0.979759588846 6.517372 1.1646888315 4.91624661156 0.06565756751 0.415616231359 0.955161449501 341.649568 22.985582119 298.627331442 0.419083929605 10.6528487313 9.96470995089 9.00781 1.72867329826 5.93156493193 0.114171250056 0.522861238893 1.71053921809 5.672658 1.09624582867 4.99697404601 0.064801233658 0.373191456014 0.141446431877 6.594935 1.35265053049 5.22465681691 0.08412266234 0.460719400686 0.472786683436 7.379856 1.30253144084 5.72140550997 0.100871594399 0.572915406764 0.682131121466 21519.930151 4230.63680752 11798.1287122 305.361644351 4988.7050454 198.09820689 9.492324 2.18178420059 4.51641093901 0.183551942694 0.769499920699 2.84107743185 26.901 3.25540859759 22.0093278056 0.165411418391 1.54878704716 0.922063425133 146.926194 9.8888897901 53.4946002261 15.6054390704 31.6635159425 37.2737441206 6.848337 1.20121128105 5.78843902954 0.148807601882 0.477866702863 0.232012182119 21.016626 2.35483870405 8.23961222612 0.138421059334 1.29351234059 9.99024221525 6.090279 1.46265876068 5.0422909272 0.100363582482 0.433581547565 0.051385346084 7.771176 1.77339407127 3.82257202758 0.642051854681 1.5794350158 0.953724606551 97.577133 26.7636594122 14.4293415261 20.6718529498 21.3587378819 15.3535423978 6.134638 1.38929085799 5.14648170038 0.116336719557 0.291448095426 0.191082002218 53.821491 4.36634865239 41.8615253686 0.289798598491 4.90109892042 3.4027185247 6.264089 1.40775070487 4.91992619525 0.077891609244 0.432527424718 0.425994361119 5.829293 0.917042105578 3.15479251451 0.127455194232 1.44255361781 1.18744988809 7.838454 1.39375888586 5.6419023774 0.074390385279 0.301265017328 1.42713677989 9.317812 3.30122466777 4.97290991515 0.275230102828 1.02015563494 0.7482920531 5.985482 1.33890064768 4.14219533253 0.142846647544 0.490666287616 0.870872726274 20.922575 9.94061386035 8.56710967016 0.580034007309 1.28280584594 1.55201234909 5.675091 1.45582037769 4.03126153037 0.110798712902 0.498689434147 0.578520568002 7.998745 3.14050917824 4.16896778688 0.27823454398 0.581053378445 0.829978235295 34.596309 14.4517389526 12.9362910285 2.37514755829 2.42415888275 3.40897472795 88.055074 6.91802190709 73.811697961 0.117143965926 4.67438064105 3.53381603235 5.528856 1.25581445295 4.21204319432 0.169648532507 0.596406499242 0.294942836933 5.860448 1.64059604198 4.12977553979 0.197564363728 0.703292195321 0.189220619708 99.306664 19.266695218 15.4646691311 22.6368626372 30.222067687 12.7163708133 5.748278 1.5271899037 4.15422606426 0.140154215733 0.509911769132 0.416795502596 6.260052 1.78477330451 3.9096285409 0.191736898297 0.835461734844 0.538452801553 12.221977 5.38977618815 5.50733672077 0.550431401359 1.44690369061 0.327529875188 5.43355 1.32855027759 4.11987661131 0.149601915329 0.63559010015 0.199930418282 11.702255 1.97407153775 7.90787103471 0.190948765582 0.721484899745 1.90787670665 71.722757 42.954007571 11.4234645596 3.95643425281 13.3364173182 1.05242955878 5.695086 1.68460350708 4.09696226689 0.186132267291 0.687744329287 0.039644667596 6.323388 2.13690658443 4.06791741801 0.193572170727 0.66775413112 0.257236525447 0.0 0.0 1.0 0.0 0.0 0.0 34.671712 10.2056628922 19.2804166749 1.00287918914 2.52003877664 2.66272057881 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0\n4265.89904 981.51176766 14.5049770912 2781.65044004 389.297108457 99.9346857762 261.750074 107.661754449 4.87687027818 62.4620658837 46.2167932284 41.5325976953 640.213305 140.58853861 2.59731825188 433.2090959 50.723000751 14.0953159908 19.966865 4.0359656077 0.06565756751 14.2550094395 1.03088693488 1.57934160813 49.009292 6.76007806617 0.419083929605 39.1305854064 2.27962878054 1.41991503845 22.070346 5.20290840138 0.114171250056 13.8693609239 0.906925052069 2.97697970118 19.99358 4.48308876213 0.064801233658 14.588657176 1.07156893439 0.785465279141 20.244893 4.55532939722 0.08412266234 14.5404185255 0.994758819748 1.07026300633 20.539664 4.53683641168 0.100871594399 13.9218552784 1.02150797483 1.95859497234 4992.407528 1865.7223575 305.361644351 582.370771504 2200.54001572 39.412674863 51.456696 6.88602223104 0.183551942694 36.9402961233 2.10678040853 6.34004355454 17.53914 2.84017897226 0.165411418391 14.5643881579 0.569607108327 0.399553331591 15977.875037 585.24197011 15.6054390704 12527.0261233 2610.53667265 240.464567972 53.381745 11.0624466954 0.148807601882 36.5098575408 3.69110210833 2.96952897873 38.678622 5.84192771675 0.138421059334 16.5036032986 2.87392585353 14.3207419658 20.879213 5.64047530546 0.100363582482 14.7719081502 1.0424537935 0.324016442434 149.535412 33.3276151672 0.642051854681 87.1137496227 21.1431987983 8.30879668964 10090.116346 1044.17758946 20.6718529498 7658.1378723 1277.16843687 90.9604914697 20.889558 5.59585291114 0.116336719557 14.7885456312 0.998543026467 0.390276977091 25.672477 5.27468573647 0.289798598491 16.5219819777 3.61301226157 0.972995706958 16.698312 3.34087471923 0.077891609244 13.1567564469 0.853175116528 0.269615124089 26.105835 6.32299306317 0.127455194232 14.0130496289 2.87551172956 3.76682335994 22.269768 4.37476356299 0.074390385279 14.6468398491 1.3932870064 2.78048623336 25.14345 8.60175067026 0.275230102828 14.2293158016 2.40247430289 0.634679649409 22.719442 6.27436394056 0.142846647544 14.6248895829 1.08619931605 1.59114768913 48.564658 23.3746621254 0.580034007309 21.2521133555 3.29073832774 1.06710834885 22.967672 7.16029222417 0.110798712902 14.2184545748 1.3601011493 1.11802274454 29.471193 13.0760825782 0.27823454398 13.9664420767 2.01834626648 1.13208598676 236.486882 130.463321819 2.37514755829 84.7727344137 14.6932917365 5.1823852201 16.838596 1.9921186534 0.117143965926 13.7575780931 0.634127389111 1.33762546266 84.342428 11.8755692019 0.169648532507 68.3783743982 4.37819944084 0.54063395243 18.270696 10.4972031526 0.197564363728 7.31477150055 1.04111940741 0.220034469684 10295.171183 957.798893489 22.6368626372 7784.17951256 1477.96313292 53.592669815 22.381317 6.69166903172 0.140154215733 14.4740318797 1.4222947798 0.653168828565 25.260472 7.41818937155 0.191736898297 14.9814714082 2.86931902642 0.799756947398 35.330343 20.4526254956 0.550431401359 11.6506190379 3.03162955664 0.645034229904 16.311443 8.72846326719 0.149601915329 6.96377618617 1.11834377043 0.351256570052 20.067429 7.68847999549 0.190948765582 7.72715813072 1.60025887609 3.86058544685 119.712466 64.2436913505 3.95643425281 28.7738071137 22.0173931301 1.72113422238 15.799416 7.86719812571 0.186132267291 7.16326479485 1.29053168192 0.292289607795 15.747027 7.82673949838 0.193572170727 7.09055603372 1.48305592497 0.153106026364 0.0 0.0 0.0 1.0 0.0 0.0 75.319344 43.4838988521 1.00287918914 24.4105990579 4.28688960712 3.13507599841 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0\n830.630244 242.178621611 8.02633584759 389.297108457 159.733739232 32.3944315698 466.760723 134.406886545 17.8794665933 46.2167932284 100.544792631 168.712791912 132.374298 47.7061355483 2.80053523968 50.723000751 28.6486862924 3.49593278675 5.12993 1.5566742118 0.415616231359 1.03088693488 2.2161175408 0.910634997432 21.181147 3.92979018364 10.6528487313 2.27962878054 4.36905504867 0.949825012056 7.180066 2.06578115721 0.522861238893 0.906925052069 2.49319166772 2.19130621833 4.827009 1.71712054285 0.373191456014 1.07156893439 2.2613394401 0.403788965495 6.061388 1.72910825089 0.460719400686 0.994758819748 2.34564332827 1.53115936622 7.085523 2.04263063079 0.572915406764 1.02150797483 2.76572246949 1.68274690944 40280.805333 8219.222229 4988.7050454 2200.54001572 24539.082787 334.255235919 15.569731 4.20805026284 0.769499920699 2.10678040853 3.11266279227 6.37273769681 5.260454 1.56522619531 1.54878704716 0.569607108327 2.23880014271 0.338032715084 7300.764322 343.088153044 31.6635159425 2610.53667265 4052.02324928 264.452631583 11.392829 3.14870711209 0.477866702863 3.69110210833 4.06368105888 1.01147253583 56.307216 4.2467817852 1.29351234059 2.87392585353 14.9888083497 33.9041913118 5.231048 1.99556271701 0.433581547565 1.0424537935 2.40519187043 0.354257920278 67.641635 14.5217604943 1.5794350158 21.1431987983 22.607276442 8.78996098608 2887.393918 397.960813326 21.3587378819 1277.16843687 1127.95481957 63.9510834796 5.116851 2.08320158496 0.291448095426 0.998543026467 2.48122824339 0.262429322392 26.168109 4.03892135766 4.90109892042 3.61301226157 11.0130706338 3.60200702585 4.837556 1.67089423926 0.432527424718 0.853175116528 2.36057310139 0.520386868208 28.544597 4.37766629066 1.44255361781 2.87551172956 13.2765980356 7.5722681573 8.295208 1.61463737664 0.301265017328 1.3932870064 2.73570422119 3.25031305638 15.255225 5.88246249436 1.02015563494 2.40247430289 5.29851179073 1.6516225595 8.708417 3.05601021407 0.490666287616 1.08619931605 2.65241669058 2.42312344041 22.232639 13.0622298302 1.28280584594 3.29073832774 4.37682587401 1.22003827517 8.599268 2.99015812015 0.498689434147 1.3601011493 2.8717078463 1.87861175113 13.168414 6.20349327151 0.581053378445 2.01834626648 3.30409461385 2.06142514172 68.316212 36.428347129 2.42415888275 14.6932917365 9.32633233027 6.44408333489 11.512941 2.02249145913 4.67438064105 0.634127389111 3.23035246016 1.95158739828 12.606374 3.7420943313 0.596406499242 4.37819944084 3.89459901698 0.995075609664 8.687057 3.7953321756 0.703292195321 1.04111940741 3.54334728324 0.603966149592 3877.491774 423.366833942 30.222067687 1477.96313292 1890.59152108 56.3482267071 8.207235 2.99604689496 0.509911769132 1.4222947798 3.14917018922 1.12981245283 13.053896 3.98140989161 0.835461734844 2.86931902642 4.84041663054 1.52728968038 20.806902 10.6679392034 1.44690369061 3.03162955664 5.32706395335 1.33336569081 7.205039 3.04121220703 0.63559010015 1.11834377043 3.03389486721 0.375997461802 20.244215 4.37589684256 0.721484899745 1.60025887609 5.12638464937 9.42018811542 217.676577 114.414123296 13.3364173182 22.0173931301 63.5687099286 5.33992526477 8.891252 4.06110984684 0.687744329287 1.29053168192 3.19049619688 0.661369392379 8.741935 3.81608796783 0.66775413112 1.48305592497 3.1902203964 0.584817222729 0.0 0.0 0.0 0.0 1.0 0.0 30.444252 14.4761946443 2.52003877664 4.28688960712 5.28157684026 4.87955404466 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0\n1887.353476 57.5914233038 9.19176814707 99.9346857762 32.3944315698 1689.24123126 6728.933297 244.898466689 59.1488014706 41.5325976953 168.712791912 6215.64093349 130.928601 12.7693488406 0.979759588846 14.0953159908 3.49593278675 100.588226037 434.426991 2.62406095241 0.955161449501 1.57934160813 0.910634997432 429.357790259 75.37126 2.86194541534 9.96470995089 1.41991503845 0.949825012056 61.1748592125 533.824764 6.39553968711 1.71053921809 2.97697970118 2.19130621833 521.550358138 196.917619 0.514774209852 0.141446431877 0.785465279141 0.403788965495 196.072145995 533.962001 2.82015996005 0.472786683436 1.07026300633 1.53115936622 529.06762335 427.046025 2.74263700722 0.682131121466 1.95859497234 1.68274690944 420.979909932 1416.055693 290.456068112 198.09820689 39.412674863 334.255235919 554.833535925 627.937858 8.84488816749 2.84107743185 6.34004355454 6.37273769681 604.539113381 193.961767 0.852120864467 0.922063425133 0.399553331591 0.338032715084 192.449984585 8882.166005 63.7739829049 37.2737441206 240.464567972 264.452631583 8277.20108054 192.252889 1.86160774615 0.232012182119 2.96952897873 1.01147253583 187.17827015 3084.937287 31.2043806331 9.99024221525 14.3207419658 33.9041913118 2996.51779903 196.535001 0.681847198478 0.051385346084 0.324016442434 0.354257920278 196.123485067 1195.55525 9.21724632175 0.953724606551 8.30879668964 8.78996098608 1169.28552142 2882.421722 58.4688770089 15.3535423978 90.9604914697 63.9510834796 2654.68780976 196.459758 0.6994213109 0.191082002218 0.390276977091 0.262429322392 195.916552264 398.22502 2.60038927758 3.4027185247 0.972995706958 3.60200702585 388.646929694 191.154076 0.815332394302 0.425994361119 0.269615124089 0.520386868208 190.122742719 1148.737439 8.04044579602 1.18744988809 3.76682335994 7.5722681573 1129.17043689 831.750608 6.88700312846 1.42713677989 2.78048623336 3.25031305638 818.40567386 191.13898 2.17902688812 0.7482920531 0.634679649409 1.6516225595 186.92536183 424.772788 3.12369836949 0.870872726274 1.59114768913 2.42312344041 417.763954179 145.792975 5.40980049618 1.55201234909 1.06710834885 1.22003827517 137.544027651 251.771088 3.12514392323 0.578520568002 1.11802274454 1.87861175113 246.070788279 249.259212 3.95039304585 0.829978235295 1.13208598676 2.06142514172 242.285342801 762.696159 15.3717700767 3.40897472795 5.1823852201 6.44408333489 733.288970127 449.564655 3.46548717524 3.53381603235 1.33762546266 1.95158739828 440.276138476 118.027438 1.76219189586 0.294942836933 0.54063395243 0.995075609664 115.434596131 107.858872 0.958729900503 0.189220619708 0.220034469684 0.603966149592 106.886918501 1520.630103 30.1589554142 12.7163708133 53.592669815 56.3482267071 1368.81396887 198.473312 1.94577018896 0.416795502596 0.653168828565 1.12981245283 195.327778452 175.895401 1.85417580645 0.538452801553 0.799756947398 1.52728968038 172.175729251 107.286172 3.11175585095 0.327529875188 0.645034229904 1.33336569081 102.868471807 107.257107 0.679473725989 0.199930418282 0.351256570052 0.375997461802 106.650444863 504.869826 7.53904599248 1.90787670665 3.86058544685 9.42018811542 483.142178823 103.714298 8.35667450692 1.05242955878 1.72113422238 5.33992526477 88.2441433865 36.764367 0.671923168486 0.039644667596 0.292289607795 0.661369392379 36.0991403204 36.894591 0.52715494147 0.257236525447 0.153106026364 0.584817222729 36.3722779151 0.0 0.0 0.0 0.0 0.0 1.0 415.792275 6.89206286442 2.66272057881 3.13507599841 4.87955404466 399.222894058 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0'
        good_M_all_inv_raw='0.170388266563 -0.17090853169 -0.14821024302 -0.170349428893 -0.169738425288 -0.170405094076 0.168780676485 -0.170243879203 -0.1590462011 -0.164180226991 -0.168933991061 -0.168815076573 0.172927228319 -0.17498421068 -0.140788767814 -0.172791317806 -0.167024225797 -0.171484213343 0.18554729795 -0.1854132101 -0.154246212795 -0.178100565594 -0.111322218562 -0.185370418331 0.174006092652 -0.173218567972 -0.17499136465 -0.172100123993 -0.133980126234 -0.171703753433 0.183178882031 -0.184501239766 -0.157889646559 -0.17398701271 -0.117219158572 -0.183224000652 0.18545304607 -0.185768875783 -0.15387313616 -0.178221325077 -0.111974236676 -0.184709447782 0.184412117707 -0.18489628816 -0.155285710228 -0.176532335212 -0.114568575235 -0.184305079684 0.181979869079 -0.182327186844 -0.156007049302 -0.173209350642 -0.124619055684 -0.181857504518 0.166798526597 -0.166850616636 -0.166770209252 -0.166248412739 -0.166833453568 -0.166498767082 0.181032214657 -0.186179236271 -0.147856384119 -0.178461946787 -0.125039655131 -0.181430566317 0.181639259045 -0.180384693759 -0.179020614413 -0.172435156682 -0.105654072813 -0.180866120719 0.167399859587 -0.165754716403 -0.16450686978 -0.167448332581 -0.16748914474 -0.167401077625 0.178109161343 -0.177594361577 -0.150752028833 -0.177551354813 -0.138573979797 -0.17741912982 0.172896227212 -0.171183471848 -0.153629457636 -0.16446687181 -0.164771175227 -0.173052810662 0.184499103587 -0.185869729955 -0.153586044702 -0.176562669196 -0.115783551317 -0.183698949777 0.174792775099 -0.174182470885 -0.131008702342 -0.174260752829 -0.171039549384 -0.174715806443 0.16864516151 -0.168853097685 -0.156555429674 -0.168622044905 -0.168677288025 -0.168646989061 0.184704131281 -0.18626051087 -0.152493557601 -0.17653154575 -0.116114867367 -0.183895372942 0.170689984501 -0.166314334056 -0.168380753523 -0.164136366862 -0.160063398098 -0.170415175437 0.185092739153 -0.18545502587 -0.153673999995 -0.175628984927 -0.115758108288 -0.184391241405 0.178407385875 -0.176661912566 -0.124978971697 -0.167935556546 -0.173631203571 -0.178384967015 0.182663517241 -0.181929080764 -0.153733246941 -0.176247878583 -0.122669157252 -0.182757016256 0.177523015421 -0.180911091272 -0.145660435932 -0.168149101905 -0.150827365936 -0.176929071572 0.184367999541 -0.187734337717 -0.146506079126 -0.175342502422 -0.121670583098 -0.184378465782 0.177640043869 -0.182479533388 -0.158525978712 -0.171414730514 -0.133122671125 -0.176817022878 0.183575417757 -0.186862385923 -0.144071369373 -0.174704801374 -0.127436605982 -0.183349413504 0.182741456966 -0.187906911343 -0.142949089238 -0.17314781391 -0.130727957361 -0.182526669386 0.172160195883 -0.17451375311 -0.160686513362 -0.170706318624 -0.149797082027 -0.172136214973 0.177499372881 -0.17364023971 -0.178795315003 -0.167571547173 -0.12511485598 -0.177378556747 0.179716024493 -0.180428401574 -0.142698201358 -0.179679247049 -0.138883117081 -0.178595026501 0.184479519669 -0.193470391 -0.145378309337 -0.153815254133 -0.139798753777 -0.183057762144 0.168498061118 -0.168528135959 -0.157424130728 -0.168488054763 -0.168587767054 -0.168473866219 0.182503891369 -0.18514257916 -0.144107361948 -0.17400558413 -0.132296628901 -0.181944004282 0.178892300167 -0.180617277317 -0.138558687151 -0.171823001192 -0.151875488912 -0.178233337545 0.178798882894 -0.186452763452 -0.148543602313 -0.159098347 -0.149679839793 -0.177426548631 0.184807879852 -0.191423207471 -0.146508942204 -0.158867893976 -0.135026372683 -0.183365638744 0.177752111383 -0.18247497273 -0.157242559758 -0.156557139378 -0.14782886809 -0.17814427456 0.173288481639 -0.178737146822 -0.144459444493 -0.160676206977 -0.171321011219 -0.171517614443 0.184648197901 -0.191980858831 -0.145797768665 -0.160695522076 -0.136359662634 -0.180517979827 0.184446768876 -0.191741113089 -0.144286082274 -0.161321697569 -0.137803079682 -0.180401300412 1.0 0.0 0.0 0.0 0.0 0.0 0.17396715505 -0.177577716564 -0.167852970818 -0.166623897844 -0.13999569544 -0.173982711705 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0\n-0.17090853169 0.174147573911 0.146031087707 0.170282184202 0.167699767176 0.170930877289 -0.170243879203 0.176501020539 0.15558798823 0.159866049567 0.167549240288 0.17025190064 -0.17498421068 0.186177265948 0.13514426733 0.173317907098 0.157317159433 0.173059276988 -0.1854132101 0.234027935424 0.145058929425 0.16618265069 0.0842580226782 0.185059311871 -0.173218567972 0.22152547425 0.17169918404 0.164918282872 0.098917563501 0.169720881225 -0.184501239766 0.219138997566 0.151524742922 0.164287639694 0.096229882925 0.184317157481 -0.185768875783 0.228867636467 0.146834567242 0.167318238593 0.0861954336557 0.185015330479 -0.18489628816 0.230520789368 0.146525095211 0.164707893712 0.0886927726403 0.184657165819 -0.182327186844 0.225032271471 0.149428181649 0.16166590289 0.0994497797704 0.18209658062 -0.166850616636 0.167026908589 0.166788173669 0.165924353847 0.16688496175 0.166524997936 -0.186179236271 0.239199746548 0.13902594713 0.177984100644 0.0709935701658 0.186617308114 -0.180384693759 0.228934609136 0.172528328842 0.162730626691 0.0759313942612 0.179490193972 -0.165754716403 0.176973725628 0.161147305701 0.165370822327 0.165050618479 0.165702647226 -0.177594361577 0.224166673096 0.142911180576 0.165334985071 0.113225058213 0.176767690185 -0.171183471848 0.209459666461 0.142367329902 0.150289929505 0.15559956989 0.171099998549 -0.185869729955 0.222994383906 0.146574253854 0.165905107695 0.0936537308945 0.185002801306 -0.174182470885 0.214801524548 0.119384171663 0.161424767197 0.156223403536 0.173983669874 -0.168853097685 0.170801559132 0.154330169994 0.168662327103 0.168507399441 0.168845431033 -0.18626051087 0.22347793215 0.145796999111 0.166231484823 0.0928518500641 0.185381412089 -0.166314334056 0.224098338448 0.159512187639 0.143555788698 0.140665118052 0.165854018594 -0.18545502587 0.242040971952 0.140991925909 0.163917528873 0.0829471280527 0.184647658434 -0.176661912566 0.223914709142 0.11535112164 0.146547325011 0.161086582856 0.176438374627 -0.181929080764 0.225799342251 0.14333134362 0.16413496445 0.103026447667 0.181778732558 -0.180911091272 0.21006725484 0.136310799595 0.159576494453 0.132855641603 0.180278969709 -0.187734337717 0.226170017268 0.142318872028 0.166115523106 0.0899193226966 0.187741926423 -0.182479533388 0.197456790583 0.155039619556 0.168703060798 0.114739850549 0.181581110965 -0.186862385923 0.228002830519 0.137176493029 0.161754872328 0.0997269193248 0.186476629994 -0.187906911343 0.211005075791 0.13777933024 0.165014738944 0.110602818664 0.187691137197 -0.17451375311 0.182119485313 0.160030857354 0.166786216407 0.142026065612 0.17452376372 -0.17364023971 0.241710698341 0.170531415891 0.155289108451 0.0856478416725 0.173180801558 -0.180428401574 0.219316777919 0.136381081427 0.175721306038 0.10913139661 0.179020890668 -0.193470391 0.243543645605 0.143303315258 0.106894154168 0.120900245953 0.191888304524 -0.168528135959 0.171014552393 0.155397144779 0.168285561811 0.168282822625 0.168491805914 -0.18514257916 0.225090310997 0.136340471012 0.162073453554 0.10692271687 0.184430484526 -0.180617277317 0.220973390377 0.127439649497 0.158487372627 0.132654277399 0.179828201797 -0.186452763452 0.21531384332 0.143094509768 0.135328771498 0.134916270841 0.184893842206 -0.191423207471 0.23831278676 0.143820165921 0.117962380007 0.118563829231 0.189917664283 -0.18247497273 0.230760609716 0.153686039945 0.122665846727 0.127403192437 0.183009181809 -0.178737146822 0.193581095548 0.127861484919 0.154329977053 0.168480754538 0.177009379371 -0.191980858831 0.239040141671 0.142646611247 0.129991536558 0.108467747314 0.187872910008 -0.191741113089 0.239064385655 0.135324508876 0.129858425306 0.116356486526 0.187655175124 0.0 1.0 0.0 0.0 0.0 0.0 -0.177577716564 0.190829634043 0.168745172769 0.155454201175 0.129671285146 0.177722304904 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0\n-0.14821024302 0.146031087707 0.266489976909 0.14912487279 0.142536005006 0.147607896548 -0.1590462011 0.15558798823 0.211180268139 0.164870049525 0.150460477881 0.158854876056 -0.140788767814 0.13514426733 0.31842069519 0.143298501026 0.123731003594 0.138616655326 -0.154246212795 0.145058929425 0.336712896926 0.152199439391 0.0580339254972 0.153748780884 -0.17499136465 0.17169918404 0.179800060185 0.173912062473 0.127330757575 0.172266652441 -0.157889646559 0.151524742922 0.309650967319 0.153467691535 0.0699047797803 0.157562153719 -0.15387313616 0.146834567242 0.331572970704 0.151401224013 0.0631425677971 0.153175395258 -0.155285710228 0.146525095211 0.327430916786 0.152683452598 0.0629171127877 0.155157655044 -0.156007049302 0.149428181649 0.313379939939 0.151889975055 0.0735218634424 0.155773198741 -0.166770209252 0.166788173669 0.166844735113 0.166358505028 0.166783460215 0.166454872961 -0.147856384119 0.13902594713 0.355791608243 0.149500302361 0.0601546342468 0.147671061413 -0.179020614413 0.172528328842 0.224768739042 0.171609049769 0.0739733829251 0.178099865072 -0.16450686978 0.161147305701 0.180734563862 0.164621936524 0.164554487115 0.164434939263 -0.150752028833 0.142911180576 0.303290716895 0.153629451181 0.0993490346273 0.150067662311 -0.153629457636 0.142367329902 0.262189915155 0.150191680307 0.138095921272 0.153525712562 -0.153586044702 0.146574253854 0.331179000062 0.150941122091 0.0647738026248 0.152945581245 -0.131008702342 0.119384171663 0.371357960995 0.137272171159 0.110071411564 0.130905140413 -0.156555429674 0.154330169994 0.220391053931 0.156808585959 0.155727178464 0.156187543677 -0.152493557601 0.145796999111 0.323300930489 0.148401541467 0.0783266220552 0.151680006894 -0.168380753523 0.159512187639 0.191715467668 0.165287954534 0.147096169482 0.168007542293 -0.153673999995 0.140991925909 0.337214298955 0.149864125911 0.06549985656 0.152755601378 -0.124978971697 0.11535112164 0.422842983419 0.125661997136 0.0862840290353 0.124880821905 -0.153733246941 0.14333134362 0.309884147474 0.151865864139 0.0875555741098 0.153629808764 -0.145660435932 0.136310799595 0.334759740059 0.14651175894 0.0920532956529 0.14470395351 -0.146506079126 0.142318872028 0.364632198468 0.142792237788 0.0574881621687 0.146262455533 -0.158525978712 0.155039619556 0.269913924004 0.161242086902 0.0985133638261 0.156764916761 -0.144071369373 0.137176493029 0.369042067071 0.143487183173 0.0625534304667 0.143669532699 -0.142949089238 0.13777933024 0.362568124744 0.143667444102 0.0707341795492 0.142302104057 -0.160686513362 0.160030857354 0.233043946953 0.164642142003 0.12113205901 0.160464385503 -0.178795315003 0.170531415891 0.195292821726 0.170199427248 0.106512693879 0.178668367355 -0.142698201358 0.136381081427 0.357465576508 0.14542557792 0.0764618574412 0.141567907535 -0.145378309337 0.143303315258 0.367247809885 0.133803493673 0.0661513303773 0.144115539095 -0.157424130728 0.155397144779 0.216005002994 0.15762022229 0.156722719543 0.156830749736 -0.144107361948 0.136340471012 0.362044872931 0.142819490653 0.0712805705938 0.143407460101 -0.138558687151 0.127439649497 0.37743106987 0.143996965883 0.0749073745991 0.137665998429 -0.148543602313 0.143094509768 0.325902286081 0.154857243798 0.0800542902655 0.147547897042 -0.146508942204 0.143820165921 0.368629400668 0.138429447766 0.0575358738303 0.145076239114 -0.157242559758 0.153686039945 0.268592616883 0.145896503505 0.117177761574 0.157404708018 -0.144459444493 0.127861484919 0.285092399092 0.163711347708 0.136023692493 0.142851948659 -0.145797768665 0.142646611247 0.370496497563 0.138801987683 0.0590399071926 0.143216965543 -0.144286082274 0.135324508876 0.373026167457 0.144796512461 0.0624216341364 0.140145431646 0.0 0.0 1.0 0.0 0.0 0.0 -0.167852970818 0.168745172769 0.218131520602 0.167491934932 0.109986342405 0.16779187698 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0\n-0.170349428893 0.170282184202 0.14912487279 0.170984316997 0.168902657377 0.170356546629 -0.164180226991 0.159866049567 0.164870049525 0.191317004712 0.155392105579 0.164374432602 -0.172791317806 0.173317907098 0.143298501026 0.175839142932 0.163565626382 0.171187509393 -0.178100565594 0.16618265069 0.152199439391 0.246431369247 0.0793117527673 0.177774394045 -0.172100123993 0.164918282872 0.173912062473 0.197487370088 0.122066923075 0.169515311332 -0.17398701271 0.164287639694 0.153467691535 0.24277429107 0.0916906154988 0.173792803719 -0.178221325077 0.167318238593 0.151401224013 0.245247375162 0.0805187701234 0.177293040003 -0.176532335212 0.164707893712 0.152683452598 0.243176912325 0.0864908281524 0.176408782217 -0.173209350642 0.16166590289 0.151889975055 0.242055920239 0.0982919311713 0.172886813001 -0.166248412739 0.165924353847 0.166358505028 0.169449767202 0.166044447183 0.165974574233 -0.178461946787 0.177984100644 0.149500302361 0.204758548491 0.110545163775 0.178750002042 -0.172435156682 0.162730626691 0.171609049769 0.234518283691 0.0870997819967 0.171607090675 -0.167448332581 0.165370822327 0.164621936524 0.167603553927 0.167504857727 0.167450521645 -0.177551354813 0.165334985071 0.153629451181 0.210097045239 0.116821495461 0.176565779193 -0.16446687181 0.150289929505 0.150191680307 0.223163638479 0.147367940578 0.164520154133 -0.176562669196 0.165905107695 0.150941122091 0.242815877916 0.0880183179434 0.175756660338 -0.174260752829 0.161424767197 0.137272171159 0.192248507882 0.160575687593 0.174218131241 -0.168622044905 0.168662327103 0.156808585959 0.168776083334 0.168507545829 0.168623437998 -0.17653154575 0.166231484823 0.148401541467 0.24212900565 0.0910279593197 0.175678552276 -0.164136366862 0.143555788698 0.165287954534 0.227544918905 0.135527193187 0.163948055827 -0.175628984927 0.163917528873 0.149864125911 0.247072636163 0.0885665685069 0.174950160693 -0.167935556546 0.146547325011 0.125661997136 0.240805863892 0.151196654716 0.167852750157 -0.176247878583 0.16413496445 0.151865864139 0.244737707399 0.0867136361215 0.176299868286 -0.168149101905 0.159576494453 0.14651175894 0.24081714298 0.11730693285 0.167638590856 -0.175342502422 0.166115523106 0.142792237788 0.241701223084 0.0987972110958 0.175250866049 -0.171414730514 0.168703060798 0.161242086902 0.224159134573 0.103901493502 0.1705795477 -0.174704801374 0.161754872328 0.143487183173 0.246794131725 0.0987743170877 0.17448483273 -0.17314781391 0.165014738944 0.143667444102 0.252141546272 0.0930491793571 0.172979155124 -0.170706318624 0.166786216407 0.164642142003 0.193037468887 0.134079973954 0.170747933364 -0.167571547173 0.155289108451 0.170199427248 0.232651561092 0.106950875199 0.167337513536 -0.179679247049 0.175721306038 0.14542557792 0.195988464243 0.124515720322 0.178669778506 -0.153815254133 0.106894154168 0.133803493673 0.343783456864 0.109009382255 0.152694612651 -0.168488054763 0.168285561811 0.15762022229 0.168650928792 0.168491402427 0.168463862936 -0.17400558413 0.162073453554 0.142819490653 0.243812600601 0.103816145269 0.173472698442 -0.171823001192 0.158487372627 0.143996965883 0.246291088074 0.108126747624 0.171274795395 -0.159098347 0.135328771498 0.154857243798 0.287257917517 0.105279766553 0.158178246908 -0.158867893976 0.117962380007 0.138429447766 0.343477203441 0.0839296745804 0.157333390971 -0.156557139378 0.122665846727 0.145896503505 0.309618073615 0.108748945934 0.156513135208 -0.160676206977 0.154329977053 0.163711347708 0.210467617771 0.151830710074 0.158984287941 -0.160695522076 0.129991536558 0.138801987683 0.325348457042 0.0883303650983 0.156832186087 -0.161321697569 0.129858425306 0.144796512461 0.33344866879 0.0724100187026 0.158164302374 0.0 0.0 0.0 1.0 0.0 0.0 -0.166623897844 0.155454201175 0.167491934932 0.22987509743 0.114015012955 0.166539865014 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0\n-0.169738425288 0.167699767176 0.142536005006 0.168902657377 0.181442640293 0.169680451967 -0.168933991061 0.167549240288 0.150460477881 0.155392105579 0.188980808684 0.168683510201 -0.167024225797 0.157317159433 0.123731003594 0.163565626382 0.222797926319 0.165563990775 -0.111322218562 0.0842580226782 0.0580339254972 0.0793117527673 0.556553474287 0.110520340237 -0.133980126234 0.098917563501 0.127330757575 0.122066923075 0.386840408139 0.130863968349 -0.117219158572 0.096229882925 0.0699047797803 0.0916906154988 0.509049498726 0.115906407468 -0.111974236676 0.0861954336557 0.0631425677971 0.0805187701234 0.547433662633 0.110735286329 -0.114568575235 0.0886927726403 0.0629171127877 0.0864908281524 0.533951137286 0.113379191315 -0.124619055684 0.0994497797704 0.0735218634424 0.0982919311713 0.48084895512 0.123268364527 -0.166833453568 0.16688496175 0.166783460215 0.166044447183 0.166935364457 0.166518290735 -0.125039655131 0.0709935701658 0.0601546342468 0.110545163775 0.511257876068 0.122009186701 -0.105654072813 0.0759313942612 0.0739733829251 0.0870997819967 0.55269987846 0.104641775744 -0.16748914474 0.165050618479 0.164554487115 0.167504857727 0.167914033141 0.16748688183 -0.138573979797 0.113225058213 0.0993490346273 0.116821495461 0.394936132582 0.137094146859 -0.164771175227 0.15559956989 0.138095921272 0.147367940578 0.229918497627 0.164246687789 -0.115783551317 0.0936537308945 0.0647738026248 0.0880183179434 0.523177393312 0.114593493433 -0.171039549384 0.156223403536 0.110071411564 0.160575687593 0.231409928531 0.170680321596 -0.168677288025 0.168507399441 0.155727178464 0.168507545829 0.169912167949 0.168668450841 -0.116114867367 0.0928518500641 0.0783266220552 0.0910279593197 0.506509677177 0.115169137083 -0.160063398098 0.140665118052 0.147096169482 0.135527193187 0.257595651297 0.159052357133 -0.115758108288 0.0829471280527 0.06549985656 0.0885665685069 0.532928773456 0.114299288169 -0.173631203571 0.161086582856 0.0862840290353 0.151196654716 0.254611019003 0.173190404061 -0.122669157252 0.103026447667 0.0875555741098 0.0867136361215 0.478581141676 0.121454441788 -0.150827365936 0.132855641603 0.0920532956529 0.11730693285 0.358209656764 0.148746699596 -0.121670583098 0.0899193226966 0.0574881621687 0.0987972110958 0.512554792828 0.119570446658 -0.133122671125 0.114739850549 0.0985133638261 0.103901493502 0.418761446309 0.130961393013 -0.127436605982 0.0997269193248 0.0625534304667 0.0987743170877 0.486697739019 0.124810651874 -0.130727957361 0.110602818664 0.0707341795492 0.0930491793571 0.466847663004 0.128038302534 -0.149797082027 0.142026065612 0.12113205901 0.134079973954 0.304322515735 0.14864207925 -0.12511485598 0.0856478416725 0.106512693879 0.106950875199 0.451876372313 0.123897409119 -0.138883117081 0.10913139661 0.0764618574412 0.124515720322 0.415027229724 0.135980509978 -0.139798753777 0.120900245953 0.0661513303773 0.109009382255 0.42690827896 0.137231798312 -0.168587767054 0.168282822625 0.156722719543 0.168491402427 0.169361841053 0.168553446235 -0.132296628901 0.10692271687 0.0712805705938 0.103816145269 0.455455387256 0.130228302455 -0.151875488912 0.132654277399 0.0749073745991 0.108126747624 0.382840538398 0.149595521841 -0.149679839793 0.134916270841 0.0800542902655 0.105279766553 0.383934480334 0.146135117876 -0.135026372683 0.118563829231 0.0575358738303 0.0839296745804 0.471953338402 0.132990910969 -0.14782886809 0.127403192437 0.117177761574 0.108748945934 0.354598442252 0.144243372006 -0.171321011219 0.168480754538 0.136023692493 0.151830710074 0.203863435804 0.16848038994 -0.136359662634 0.108467747314 0.0590399071926 0.0883303650983 0.480533065267 0.127269683466 -0.137803079682 0.116356486526 0.0624216341364 0.0724100187026 0.4813996452 0.129609040146 0.0 0.0 0.0 0.0 1.0 0.0 -0.13999569544 0.129671285146 0.109986342405 0.114015012955 0.368901704243 0.137429597435 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0\n-0.170405094076 0.170930877289 0.147607896548 0.170356546629 0.169680451967 0.171019083282 -0.168815076573 0.17025190064 0.158854876056 0.164374432602 0.168683510201 0.169020207722 -0.171484213343 0.173059276988 0.138616655326 0.171187509393 0.165563990775 0.180088475191 -0.185370418331 0.185059311871 0.153748780884 0.177774394045 0.110520340237 0.187526680249 -0.171703753433 0.169720881225 0.172266652441 0.169515311332 0.130863968349 0.185929547785 -0.183224000652 0.184317157481 0.157562153719 0.173792803719 0.115906407468 0.185197497003 -0.184709447782 0.185015330479 0.153175395258 0.177293040003 0.110735286329 0.189071558473 -0.184305079684 0.184657165819 0.155157655044 0.176408782217 0.113379191315 0.186092250167 -0.181857504518 0.18209658062 0.155773198741 0.172886813001 0.123268364527 0.184117567899 -0.166498767082 0.166524997936 0.166454872961 0.165974574233 0.166518290735 0.16802842741 -0.181430566317 0.186617308114 0.147671061413 0.178750002042 0.122009186701 0.183521875179 -0.180866120719 0.179490193972 0.178099865072 0.171607090675 0.104641775744 0.185294933657 -0.167401077625 0.165702647226 0.164434939263 0.167450521645 0.16748688183 0.167523932275 -0.17741912982 0.176767690185 0.150067662311 0.176565779193 0.137094146859 0.182085593883 -0.173052810662 0.171099998549 0.153525712562 0.164520154133 0.164246687789 0.173554629999 -0.183698949777 0.185002801306 0.152945581245 0.175756660338 0.114593493433 0.188002608467 -0.174715806443 0.173983669874 0.130905140413 0.174218131241 0.170680321596 0.175496986576 -0.168646989061 0.168845431033 0.156187543677 0.168623437998 0.168668450841 0.169028127218 -0.183895372942 0.185381412089 0.151680006894 0.175678552276 0.115169137083 0.18819548403 -0.170415175437 0.165854018594 0.168007542293 0.163948055827 0.159052357133 0.172722812577 -0.184391241405 0.184647658434 0.152755601378 0.174950160693 0.114299288169 0.188956174098 -0.178384967015 0.176438374627 0.124880821905 0.167852750157 0.173190404061 0.179252692776 -0.182757016256 0.181778732558 0.153629808764 0.176299868286 0.121454441788 0.184080020989 -0.176929071572 0.180278969709 0.14470395351 0.167638590856 0.148746699596 0.181702783359 -0.184378465782 0.187741926423 0.146262455533 0.175250866049 0.119570446658 0.186795785231 -0.176817022878 0.181581110965 0.156764916761 0.1705795477 0.130961393013 0.183295900114 -0.183349413504 0.186476629994 0.143669532699 0.17448483273 0.124810651874 0.187208936049 -0.182526669386 0.187691137197 0.142302104057 0.172979155124 0.128038302534 0.186462471035 -0.172136214973 0.17452376372 0.160464385503 0.170747933364 0.14864207925 0.173485669976 -0.177378556747 0.173180801558 0.178668367355 0.167337513536 0.123897409119 0.179537236364 -0.178595026501 0.179020890668 0.141567907535 0.178669778506 0.135980509978 0.186165886982 -0.183057762144 0.191888304524 0.144115539095 0.152694612651 0.137231798312 0.191011995635 -0.168473866219 0.168491805914 0.156830749736 0.168463862936 0.168553446235 0.16918622033 -0.181944004282 0.184430484526 0.143407460101 0.173472698442 0.130228302455 0.186517032943 -0.178233337545 0.179828201797 0.137665998429 0.171274795395 0.149595521841 0.183402218586 -0.177426548631 0.184893842206 0.147547897042 0.158178246908 0.146135117876 0.185818473846 -0.183365638744 0.189917664283 0.145076239114 0.157333390971 0.132990910969 0.191316127304 -0.17814427456 0.183009181809 0.157404708018 0.156513135208 0.144243372006 0.180685142554 -0.171517614443 0.177009379371 0.142851948659 0.158984287941 0.16848038994 0.181156176399 -0.180517979827 0.187872910008 0.143216965543 0.156832186087 0.127269683466 0.204290256047 -0.180401300412 0.187655175124 0.140145431646 0.158164302374 0.129609040146 0.20402474732 0.0 0.0 0.0 0.0 0.0 1.0 -0.173982711705 0.177722304904 0.16779187698 0.166539865014 0.137429597435 0.176533716118 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0 0.0 0.0 0.0 0.0 0.0 1.0'
        good_w_raw='0.0275481449664 0.0251126099226 0.021230055038 0.000993710437875 0.0151968339032 0.000826384221217 0.0 0.00171581863595 0.00264229355156 0.0344547558177 0.00413469947331 0.00373656530603 0.0252308854181 0.00660958751464 0.0154104009314 0.0 0.0141761373223 0.0389517072132 0.0 0.0193938504056 0.0 0.00653719949008 0.000595918965573 0.00807861827784 0.00139433099563 0.00634455508827 0.00117222306306 0.00118440742404 0.0153253884441 0.000245026398557 0.000333941409039 0.0 0.0421125735971 0.000600495147514 0.00520087421269 0.00879149734948 0.0 0.0102177590032 0.0210455699735 0.0 0.0 0.0 0.0140511900945 0.0 0.0 0.0 0.0 0.0 0.0\n-0.0200882491787 -0.00397807983322 -0.00545937040105 -0.00153412893308 -0.025764836983 0.00131623387175 0.0 -0.00224742748483 -0.002781872651 -0.00630726625538 0.0212702020428 -0.00907499697682 -0.158451678335 -0.0133128998463 -0.0241674994764 0.0 -0.0313173227543 -0.0592078314431 0.0 -0.0379320942845 0.0 -0.0171351499592 -0.00147410395195 0.000337922740039 0.000286352091636 0.0132172522599 -0.00131887083504 0.0117612845054 0.00965507741234 -0.0179272503407 -0.00980617530188 0.0 -0.0928549413012 -0.000672520830915 -0.00790037375559 0.00131668937591 0.0 -0.0151104186704 0.0252408668051 0.0 0.0 0.0 0.00457993786396 0.0 0.0 0.0 0.0 0.0 0.0\n-0.0064135017102 0.00390855722668 -0.00862123915581 -0.00178554530416 0.0644448793188 0.000152845461654 0.0 -0.00218534690365 -0.00372433174173 0.0723201406416 -0.00647397880625 0.0431943371268 0.043094178666 -0.00545856369838 5.62929997194e-06 0.0 -0.0303230469697 -0.0120779492661 0.0 0.0372537436799 0.0 -0.0371430598793 -0.00180586274215 -0.00182067598873 -0.00252126879706 0.0244093005725 -0.0015559574822 -0.00102331571235 0.0264592619446 0.0833624885261 0.00500682368764 0.0 0.0030157538624 -0.000778181228727 -0.0106952185566 0.00382422295919 0.0 0.0179947424483 -0.0364655362229 0.0 0.0 0.0 0.0330124115515 0.0 0.0 0.0 0.0 0.0 0.0\n0.0241977080117 -0.0390406105923 0.0223806485584 -0.00111147032813 0.00778828676296 -0.0025194944753 0.0 -0.00197379968731 -0.00358087454648 -0.0769416552745 0.0228938227358 -0.00216094076468 0.0402147062565 0.0128215116594 -0.0211759708769 0.0 0.0134370973209 0.0508649373337 0.0 -0.0189439350318 0.0 -0.0141772149481 -0.000821340478674 -0.0171595392758 -0.00258285351942 -0.0172135488856 -0.00162870832237 -0.00880723638835 -0.00218868828939 0.00457842484415 0.0321454387196 0.0 0.0683419955126 -0.000538065444307 -0.00785043804292 -0.0124545001 0.0 -0.00571018380605 -0.0428902014808 0.0 0.0 0.0 0.00381057188702 0.0 0.0 0.0 0.0 0.0 0.0\n0.0492754267012 0.0776253215567 0.0429411661775 0.00179420922034 -0.003336226279 -0.00280362790556 0.0 0.00424114585131 0.0108416700854 0.110823313311 -0.0503020863854 -0.0243363118654 0.113531964479 0.0195179370832 0.0631658275908 0.0 0.0681200064341 0.0800826785527 0.0 0.0543347040374 0.0 0.0732220979958 -0.00199220217833 0.0351720627303 0.000695691492579 -0.00698640550225 0.00294429866832 -0.00334099697225 -0.0120938397885 -0.0783512085393 -0.0268887028797 0.0 0.0894668110414 -0.00191525496701 0.03273248656 0.0254984974962 0.0 -0.00181549064689 0.0840167123464 0.0 0.0 0.0 -0.0366513887074 0.0 0.0 0.0 0.0 0.0 0.0\n-0.0194047818958 -0.0134002025772 -0.0300047920279 0.00363065036529 -0.0279343735119 0.00467963489452 0.0 0.00388129017858 0.00188672159575 -0.0654477829738 0.0167476944514 -0.00388545550883 -0.0132342743852 -0.0069583619441 -0.00241776221621 0.0 -0.005739297436 -0.0207431784699 0.0 -0.0153176248711 0.0 0.00177456529519 0.00668838766789 -0.00845218620537 0.00551635988279 -0.00708405452363 0.0027314606589 0.00259374309991 -0.00650647199659 0.00858349892868 -0.000123292641379 0.0 -0.0258788743345 0.00450345048776 -0.00108562252242 -0.00939439544284 0.0 0.0148559521645 -0.00886197040526 0.0 0.0 0.0 0.0092969609501 0.0 0.0 0.0 0.0 0.0 0.0'
        good_b_raw='317.0 148.0 42.0 2.0 27.0 3.0 0.0 3.0 2.0 8726.0 15.0 1.0 2026.0 1.0 44.0 0.0 18.0 1258.0 0.0 6.0 0.0 11.0 6.0 1.0 3.0 4.0 1.0 2.0 27.0 10.0 2.0 0.0 1575.0 1.0 1.0 2.0 0.0 13.0 49.0 0.0 0.0 0.0 17.0 0.0 0.0 0.0 0.0 0.0 0.0\n76.381571 25.959209 12.349645 0.001882 1.714095 0.095016 0.0 0.009439 0.02798 1978.657454 0.863978 0.004638 71.301756 0.118065 0.477523 0.0 1.470562 126.713397 0.0 0.189583 0.0 0.077406 0.023062 0.602001 0.074792 3.039571 0.014779 0.881594 13.152121 0.184005 0.000779 0.0 133.801629 0.003231 0.038985 1.275463 0.0 0.14673 28.004292 0.0 0.0 0.0 4.685837 0.0 0.0 0.0 0.0 0.0 0.0\n1.716937 3.865702 0.462668 5.2e-05 23.53414 0.016877 0.0 0.000481 0.001705 2084.427217 0.069492 0.980021 8.174571 0.007297 0.321631 0.0 0.04946 4.485357 0.0 2.646368 0.0 0.011142 0.001312 0.09217 0.003062 0.443308 0.001328 0.039905 0.955323 5.715307 1e-06 0.0 6.361524 1.7e-05 0.0019 0.162569 0.0 0.257985 3.118543 0.0 0.0 0.0 1.106627 0.0 0.0 0.0 0.0 0.0 0.0\n182.26086 6.756493 24.252525 0.005272 0.855112 0.001549 0.0 0.003988 0.006193 378.811464 1.203947 1.9e-05 1108.043524 0.724237 0.252299 0.0 3.619778 820.877056 0.0 0.177021 0.0 0.076149 0.010479 0.040497 0.004874 0.234854 0.001208 0.0616 4.549773 0.002963 1.992823 0.0 1007.516153 0.00126 0.04616 0.265781 0.0 0.102628 4.597172 0.0 0.0 0.0 1.255632 0.0 0.0 0.0 0.0 0.0 0.0\n34.62834 14.996486 4.786251 0.008104 0.883803 0.009712 0.0 0.019435 0.040408 4225.121344 0.147288 0.015322 692.722654 0.150377 1.56904 0.0 2.229884 242.614743 0.0 1.011653 0.0 1.00282 0.017164 0.254546 0.024187 0.249149 0.016732 0.064495 1.275954 0.122784 0.006396 0.0 392.764513 0.000808 0.161757 0.288052 0.0 0.275213 11.331901 0.0 0.0 0.0 0.445394 0.0 0.0 0.0 0.0 0.0 0.0\n22.012307 96.422117 0.148915 1.98469 0.01285 2.876845 0.0 2.966657 1.923713 58.982531 12.715296 0.0 145.757388 2.4e-05 41.379508 0.0 10.630317 63.309403 0.0 1.975376 0.0 9.832487 5.947982 0.010785 2.893085 0.033116 0.965953 0.952405 7.066829 3.974941 1e-06 0.0 34.55615 0.994683 0.751198 0.008134 0.0 12.217442 1.948085 0.0 0.0 0.0 9.506508 0.0 0.0 0.0 0.0 0.0 0.0'
        key_list_old_raw='109453 109473 109484 109492 109494 109495 109498 109501 109502 109503 109505 109506 109508 109509 109510 109511 109512 109513 109514 109515 109519 109520 109521 109522 109523 109524 109525 109526 109527 109529 109530 109531 109532 109533 109534 109535 109536 109538 109540 109542 109543 109544 109417 109546 109547 109548 109550 109552 109545'


        good_M_all = np.array([np.fromstring(line, dtype=np.float64, sep=' ') for line in good_M_all_raw.split("\n")])
        good_M_all_inv = np.array([np.fromstring(line, dtype=np.float64, sep=' ') for line in good_M_all_inv_raw.split("\n")])
        good_w = np.array([np.fromstring(line, dtype=np.float64, sep=' ') for line in good_w_raw.split("\n")])
        good_b = np.array([np.fromstring(line, dtype=np.float64, sep=' ') for line in good_b_raw.split("\n")])
        key_list_old = np.array(np.fromstring(key_list_old_raw, dtype=np.int, sep=' '))

        for indexGood, oldArt in enumerate(key_list_old):
            if self.mapping.has_key(oldArt):
                index=self.mapping[oldArt] #index in new
                self.all_w[:,[index]] = good_w[:,[indexGood]]
                self.all_b[:,[index]] = good_b[:,[indexGood]]
                self.all_M[:,range(index*6,index*6+6)]=good_M_all[:,range(indexGood*6,indexGood*6+6)]
                self.all_M_inv[:,range(index*6,index*6+6)]=good_M_all_inv[:,range(indexGood*6,indexGood*6+6)]






    def recommend(self, timestamp, user_features, articles):
        user_features = np.reshape(user_features, (6, 1))
        hours = int(datetime.datetime.fromtimestamp(timestamp).strftime('%H'))
        day = int(datetime.datetime.fromtimestamp(timestamp).strftime('%d'))
        if self.dayCheck is None:
            self.dayCheck = day+1
        if day == self.dayCheck and hours >= 3:
            self.dayCheck += 1

            #initialize everything

            self.articleSize = self.keyList.size
            self.all_w = np.zeros((6,self.articleSize))
            M = np.identity(6)
            self.all_M = np.tile(M,(1,self.articleSize))
            self.all_M_inv = np.tile(M,(1,self.articleSize))

            self.all_b = np.zeros((6,self.articleSize))


        indicesOfArticles = [self.mapping[article] for article in articles]

        w_x = self.all_w[:,indicesOfArticles]
        exploitPart=np.dot(w_x.T,user_features)

        indicesForM_inv = [range(index*6,index*6+6) for index in indicesOfArticles]
        indicesForM_inv = list(itertools.chain(*indicesForM_inv))

        allM_inv = self.all_M_inv[:,indicesForM_inv]
        explorePart = np.dot((np.dot(user_features.T,allM_inv)).reshape(len(articles),6),user_features)
        explorePart = self.alpha*np.power(explorePart,0.5)

        UCB = (exploitPart + explorePart).flatten()

        bestArticle=articles[np.argmax(UCB)]

        self.current_user = user_features
        self.current_article = bestArticle
        return bestArticle


    def update(self, reward):
        if reward == 0 or reward == 1:
            article = self.current_article
            user = self.current_user

            indexForArticle = np.zeros((self.articleSize),dtype=bool)
            indexForArticle[self.mapping[article]] = True

            M = self.all_M[:,indexForArticle.repeat(6)]
            b = self.all_b[:,indexForArticle]

            self.all_M[:,indexForArticle.repeat(6)] = M + np.dot(user, user.T)
            self.all_b[:,indexForArticle] = b + reward * user

            # precompute M^-1 and w for UCB
            self.all_M_inv[:,indexForArticle.repeat(6)] = np.linalg.inv(self.all_M[:,indexForArticle.repeat(6)])
            self.all_w[:,indexForArticle] = np.dot(self.all_M_inv[:,indexForArticle.repeat(6)], self.all_b[:,indexForArticle])

    def lastCall(self):
       print'#############################'
       #print 'good_M_all'
       print '\\n'.join([' '.join([str(n) for n in m]) for m in self.all_M.tolist()])
       #print 'good_M_all_inv'
       print '\\n'.join([' '.join([str(n) for n in m]) for m in self.all_M_inv.tolist()])
       #print 'good_w'
       print '\\n'.join([' '.join([str(n) for n in m]) for m in self.all_w.tolist()])
       #print 'good_b'
       print '\\n'.join([' '.join([str(n) for n in m]) for m in self.all_b.tolist()])
       #print 'key_list old'
       print ' '.join([str(n) for n in self.keyList.tolist()])
       print'#############################'
       sys.exit("Error message")




linucb = LinUCB()

# Evaluator will call this function and pass the article features.
# Check evaluator.py description for details.
def set_articles(art):
    linucb.set_articles(art)


# This function will be called by the evaluator.
# Check task description for details.
def update(reward):
    linucb.update(reward)


# This function will be called by the evaluator.
# Check task description for details.
def reccomend(timestamp, user_features, articles):
    return linucb.recommend(timestamp, user_features, articles)